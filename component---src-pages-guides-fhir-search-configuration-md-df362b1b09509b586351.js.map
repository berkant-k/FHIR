{"version":3,"sources":["webpack:///./src/pages/guides/FHIRSearchConfiguration.md"],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent"],"mappings":"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","file":"component---src-pages-guides-fhir-search-configuration-md-df362b1b09509b586351.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/FHIR/FHIR/fhir/docs/node_modules/gatsby-theme-carbon/src/templates/Default.js\";\nexport const _frontmatter = {};\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1>{`IBM FHIR Server - Search Configuration Overview`}</h1>\n    <p>{`The `}<a parentName=\"p\" {...{\n        \"href\": \"https://hl7.org/fhir/R4B/search.html\"\n      }}>{`FHIR Specification`}</a>{` defines a set of searchable fields for each resource type. The LinuxForHealth FHIR Server supports searching via both specification-defined search parameters and tenant-specific search parameters.`}</p>\n    <p>{`Specifically, the LinuxForHealth FHIR Server supports searching on additional fields, including:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`fields that are defined in the base specification, which are not configured for search; and`}</li>\n      <li parentName=\"ul\">{`extension elements that a tenant may add to a standard FHIR resource type`}</li>\n    </ul>\n    <p>{`The LinuxForHealth FHIR Server allows deployers to define search parameters on a tenant-specific basis. This allows each tenant to share an instance of the LinuxForHealth FHIR Server while maintaining the ability to have their own set of search parameters. Additionally, specification-defined search parameters can be filtered out in order to avoid the cost of extracting and storing the corresponding indices.`}</p>\n    <p>{`Tenant search parameters are defined via a `}<a parentName=\"p\" {...{\n        \"href\": \"https://hl7.org/fhir/R4B/bundle.html\"\n      }}>{`Bundle`}</a>{` of `}<a parentName=\"p\" {...{\n        \"href\": \"https://hl7.org/fhir/R4B/searchparameter.html\"\n      }}>{`SearchParameter`}</a>{` resources that define the additional search parameters which describe the searchable field and define the FHIRPath expression for extraction.  For example, a tenant that extends the `}<inlineCode parentName=\"p\">{`Patient`}</inlineCode>{` resource type with the `}<inlineCode parentName=\"p\">{`favorite-color`}</inlineCode>{` extension, enables search on `}<inlineCode parentName=\"p\">{`favorite-color`}</inlineCode>{` by defining a SearchParameter as part of this bundle.`}</p>\n    <h2>{`1 Configuration`}</h2>\n    <p>{`Since IBM FHIR Server 4.10.0, `}<em parentName=\"p\">{`all`}</em>{` SearchParameter definitions are loaded from the `}<inlineCode parentName=\"p\">{`fhir-registry`}</inlineCode>{` by the `}<inlineCode parentName=\"p\">{`fhir-search`}</inlineCode>{` module during server startup.\nThe definitions in the registry can come from the core specification, packaged implementation guides, or other registry resource providers via the FHIRRegistryResourceProvider SPI.\nAlthough FHIRRegistry is dynamic, changes to search parameters in the registry (e.g. addition, removal, or modification of SearchParameter resources) are `}<em parentName=\"p\">{`NOT`}</em>{` reflected in the running server. One must restart the server in order to apply the changes. Additionally, to apply the new search parameter configuration to previously-ingested resources, it is necessary to perform `}<a parentName=\"p\" {...{\n        \"href\": \"#2-re-index\"\n      }}>{`reindexing`}</a>{`.`}</p>\n    <p>{`In previous versions, only the built-in parameters were loaded from the registry; tenant-specific parameters were loaded from `}<inlineCode parentName=\"p\">{`extension-search-parameters.json`}</inlineCode>{` files in the tenant config folders.`}</p>\n    <p>{`For backwards compatibility, IBM FHIR Server 4.10.0 contains a new FHIRRegistryResourceProvider that reads these same `}<inlineCode parentName=\"p\">{`extension-search-parameters.json`}</inlineCode>{` files and contributes their contents to the registry, so that this same mechanism can still be used.`}</p>\n    <p>{`The LinuxForHealth FHIR Server supports compartment search based on CompartmentDefinition resources.\nSince IBM FHIR Server 4.8.1, the LinuxForHealth FHIR Server will load compartment definitions from the registry.\nIn previous versions, the CompartmentDefinition resources came from a configuration file.`}</p>\n    <h3>{`1.1 Tenant-specific parameters`}</h3>\n    <p>{`To configure tenant-specific search parameters, create a file called `}<inlineCode parentName=\"p\">{`extension-search-parameters.json`}</inlineCode>{`, populate it with a Bundle of `}<inlineCode parentName=\"p\">{`SearchParameter`}</inlineCode>{` resources, and place it in the `}<inlineCode parentName=\"p\">{`\\${server.config.dir}/config/<tenant-id>`}</inlineCode>{` directory. For example, the `}<inlineCode parentName=\"p\">{`\\${server.config.dir}/config/acme/extension-search-parameters.json`}</inlineCode>{` file would contain the search parameters for the `}<inlineCode parentName=\"p\">{`acme`}</inlineCode>{` tenant, while `}<inlineCode parentName=\"p\">{`\\${server.config.dir}/config/qpharma/extension-search-parameters.json`}</inlineCode>{` would contain search parameters used by the `}<inlineCode parentName=\"p\">{`qpharma`}</inlineCode>{` tenant.`}</p>\n    <p>{`If a tenant-specific extension-search-parameters.json file does not exist, the server falls back to the default `}<inlineCode parentName=\"p\">{`extension-search-parameters.json`}</inlineCode>{` file found at `}<inlineCode parentName=\"p\">{`\\${server.config.dir}/config/default/extension-search-parameters.json`}</inlineCode>{`. For performance reasons, we recommend having an `}<inlineCode parentName=\"p\">{`extension-search-parameters.json`}</inlineCode>{` for each tenant.`}</p>\n    <h4>{`1.2 SearchParameter details`}</h4>\n    <p>{`The `}<inlineCode parentName=\"p\">{`fhir-search`}</inlineCode>{` module requires that the `}<a parentName=\"p\" {...{\n        \"href\": \"https://hl7.org/fhir/R4B/searchparameter-definitions.html#SearchParameter.expression\"\n      }}>{`expression`}</a>{`, `}<a parentName=\"p\" {...{\n        \"href\": \"https://hl7.org/fhir/R4B/searchparameter-definitions.html#SearchParameter.type\"\n      }}>{`type`}</a>{` and `}<a parentName=\"p\" {...{\n        \"href\": \"https://hl7.org/fhir/R4B/searchparameter-definitions.html#SearchParameter.code\"\n      }}>{`code`}</a>{` be set, as in the following example:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-json\"\n      }}>{`{\n  \"fullUrl\": \"http://example.com/fhir/SearchParameter/Patient-favorite-color\",\n  \"resource\": {\n    \"resourceType\": \"SearchParameter\",\n    \"id\": \"Patient-favorite-color\",\n    \"url\": \"http://example.com/fhir/SearchParameter/Patient-favorite-color\",\n    \"version\": \"4.0.0\",\n    \"name\": \"favorite-color\",\n    \"status\": \"draft\",\n    \"experimental\": false,\n    \"date\": \"2018-12-27T22:37:54+11:00\",\n    \"publisher\": \"LinuxForHealth FHIR Server Test\",\n    \"contact\": [{\n      \"telecom\": [{\n        \"system\": \"url\",\n        \"value\": \"http://linuxforhealth.org\"\n      }]\n    },\n    {\n      \"telecom\": [{\n        \"system\": \"url\",\n        \"value\": \"http://linuxforhealth.org\"\n      }]\n    }],\n    \"description\": \"the patient's favorite color\",\n    \"code\": \"favorite-color\",\n    \"base\": [\"Patient\"],\n    \"type\": \"string\",\n    \"xpathUsage\": \"normal\",\n    \"xpath\": \"f:Patient/f:extension[@url='http://example.com/fhir/extension/Patient/favorite-color']/f:valueString\",\n    \"expression\": \"Patient.extension.where(url='http://example.com/fhir/extension/Patient/favorite-color').value\",\n    \"multipleOr\": true,\n    \"multipleAnd\": true,\n    \"modifier\": []\n  }\n}\n`}</code></pre>\n    <p>{`A couple things to note:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`This SearchParameter includes an xpath element for completeness, but the LinuxForHealth FHIR Server does not use the XPath during extraction; it only uses the expression (FHIRPath).`}</li>\n      <li parentName=\"ul\">{`SearchParameter expressions that select choice type elements should follow FHIRPath rules and omit the specific type suffixed (e.g. use `}<inlineCode parentName=\"li\">{`value`}</inlineCode>{` and not `}<inlineCode parentName=\"li\">{`valueString`}</inlineCode>{`).`}</li>\n    </ul>\n    <p>{`Each time a resource is created, updated or reindexed, the LinuxForHealth FHIR Server evaluates the FHIRPath expression applicable to the resource type and indexes the values of the matching elements, making these available via a search where the query parameter name matches the `}<inlineCode parentName=\"p\">{`code`}</inlineCode>{` element on the `}<inlineCode parentName=\"p\">{`SearchParameter`}</inlineCode>{` definition.`}</p>\n    <p>{`In the preceding example, extension elements (on a Patient resource) with a url of `}<inlineCode parentName=\"p\">{`http://example.com/fhir/extension/Patient/favorite-color`}</inlineCode>{` are indexed by the `}<inlineCode parentName=\"p\">{`favorite-color`}</inlineCode>{` search parameter. To search for Patients with a favorite color of “pink”, users could send an HTTP GET request to a URL like `}<inlineCode parentName=\"p\">{`[base]/Patient?favorite-color:exact=pink`}</inlineCode>{`.`}</p>\n    <p>{`When creating the SearchParameter FHIRPath expression, be sure to test both the FHIRPath expression and the search parameter.`}</p>\n    <p>{`If a search parameter expression extracts an element with a data type that is incompatible with the declared search parameter type, the server skips the value and logs a message. For choice elements, like Extension.value, its recommended to restrict the expression to values of the desired type by using the `}<inlineCode parentName=\"p\">{`as`}</inlineCode>{` function. For example, to select only Decimal values from the `}<a parentName=\"p\" {...{\n        \"href\": \"http://example.org/decimal\"\n      }}>{`http://example.org/decimal`}</a>{` extension, use an expressions like `}<inlineCode parentName=\"p\">{`Basic.extension.where(url='http://example.org/decimal').value.as(decimal)`}</inlineCode>{`.`}</p>\n    <h4>{`1.2.1 The implicit-system extension`}</h4>\n    <p>{`The LinuxForHealth FHIR Server team has introduced a custom SearchParameter extension that can be used to improve search performance for queries that are made against a token SearchParameter without passing a system. Specifically, for SearchParameter resources that index elements of type Code which have a required binding with a single system, adding the following extension to the SearchParameter definition allows the server to infer the system value without requiring end users to explicitly pass it in their queries:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-json\"\n      }}>{`{\n    \"url\": \"http://fhir.linuxforhealth.org/extension/implicit-system\",\n    \"valueUri\": \"http://hl7.org/fhir/account-status\"\n}\n`}</code></pre>\n    <p>{`See the `}<a parentName=\"p\" {...{\n        \"href\": \"FHIRPerformanceGuide#65-search-examples\"\n      }}>{`FHIR Performance Guide`}</a>{` for more information.`}</p>\n    <h3>{`1.3 Filtering`}</h3>\n    <p>{`The LinuxForHealth FHIR Server supports the filtering of search parameters through `}<inlineCode parentName=\"p\">{`fhir-server-config.json`}</inlineCode>{`. The default behavior of the LinuxForHealth FHIR Server is to consider all built-in and tenant-specific search parameters when storing resources or processing search requests, but you can configure inclusion filters to restrict the LinuxForHealth FHIR Server’s view to specific search parameters on a given resource type.`}</p>\n    <p>{`Why would you want to filter built-in search parameters? The answer lies in how search parameters are used by the LinuxForHealth FHIR Server. When the FHIR server processes a `}<em parentName=\"p\">{`create`}</em>{` or `}<em parentName=\"p\">{`update`}</em>{` operation, it stores the resource contents in the datastore, along with search index information that is used by the LinuxForHealth FHIR Server when performing search operations. The search index information stored for a particular resource instance is driven by the search parameters defined for that resource type. Therefore if you are storing a resource whose type has a lot of built-in search parameters defined for it (e.g. `}<inlineCode parentName=\"p\">{`Patient`}</inlineCode>{`), then you could potentially be storing a lot of search index information for each resource.`}</p>\n    <p>{`For performance and scalability reasons, it might be desirable to limit the number of search parameters considered during a `}<em parentName=\"p\">{`create`}</em>{` or `}<em parentName=\"p\">{`update`}</em>{` operation for particular resource types. If there will be no need to use the search index information, there’s no need to store it. For example, if you know that due to the way in which a particular tenant’s applications use the FHIR REST API that those applications will never need to search Patients by birthdate, then there would be no need to store search index information for the `}<inlineCode parentName=\"p\">{`birthdate`}</inlineCode>{` attribute in `}<inlineCode parentName=\"p\">{`Patient`}</inlineCode>{` resources. Consequently, you could filter out the `}<inlineCode parentName=\"p\">{`birthdate`}</inlineCode>{` search parameter for the `}<inlineCode parentName=\"p\">{`Patient`}</inlineCode>{` resource type and not lose any needed functionality, but yet save a little bit of storage capacity in your datastore.`}</p>\n    <p>{`The search parameter filtering feature is supported through a set of inclusion rules specified via the `}<inlineCode parentName=\"p\">{`fhirServer/resources`}</inlineCode>{` property group in `}<inlineCode parentName=\"p\">{`fhir-server-config.json`}</inlineCode>{`. The search parameter inclusion rules allow you to define a set of search parameters per resource type that should be included in the LinuxForHealth FHIR Server’s view of search parameters when storing resources and performing search operations. The following snippet shows the general form for specifying inclusion rules:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`\"resources\": {\n    \"open\": false,\n    \"CarePlan\": {\n        \"searchParameters\": {}\n    },\n    \"ExplanationOfBenefit\": {\n        \"searchParameters\": {\n            \"_id\": \"http://hl7.org/fhir/SearchParameter/Resource-id\",\n            \"_lastUpdated\": \"http://hl7.org/fhir/SearchParameter/Resource-lastUpdated\",\n            \"patient\": \"http://hl7.org/fhir/us/carin-bb/SearchParameter/explanationofbenefit-patient\",\n            \"type\": \"http://hl7.org/fhir/us/carin-bb/SearchParameter/explanationofbenefit-type\",\n            \"identifier\": \"http://hl7.org/fhir/us/carin-bb/SearchParameter/explanationofbenefit-identifier\",\n            \"service-date\": \"http://hl7.org/fhir/us/carin-bb/SearchParameter/explanationofbenefit-service-date\"\n        }\n    },\n    \"Patient\": {\n        \"searchParameters\": {}\n    },\n    \"RelatedPerson\": {\n        \"searchParameters\": {}\n    }\n}\n`}</code></pre>\n    <p>{`The `}<inlineCode parentName=\"p\">{`fhirServer/resources/<resourceType>/searchParameters`}</inlineCode>{` property group is a JSON map where the key is the search parameter code that will be used to search on this parameter and the value is a canonical URL which resolves to a SearchParameter definition from the `}<inlineCode parentName=\"p\">{`fhir-registry`}</inlineCode>{` at run-time.\nOmitting this property is equivalent to supporting all search parameters in the server’s registry that apply to the given resource type.\nAn empty object, `}<inlineCode parentName=\"p\">{`{}`}</inlineCode>{`, can be used to indicate that no search parameters are supported.`}</p>\n    <p>{`It may be desirable to re-define a single search parameter code. In this case, if you do not wish to filter any other parameters for this type, a value of `}<inlineCode parentName=\"p\">{`\"*\": \"*\"`}</inlineCode>{` can be used to prevent further filtering.`}</p>\n    <p>{`Additionally, for SearchParameters defined across all resource types (i.e. SearchParameters with a base of type `}<inlineCode parentName=\"p\">{`Resource`}</inlineCode>{`), the filter can be applied at this level as well:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`\"resources\": {\n    \"open\": false,\n    \"CarePlan\": {\n        \"searchParameters\": {}\n    },\n    \"ExplanationOfBenefit\": {\n        \"searchParameters\": {\n            \"patient\": \"http://hl7.org/fhir/us/carin-bb/SearchParameter/explanationofbenefit-patient\",\n            \"type\": \"http://hl7.org/fhir/us/carin-bb/SearchParameter/explanationofbenefit-type\",\n            \"identifier\": \"http://hl7.org/fhir/us/carin-bb/SearchParameter/explanationofbenefit-identifier\",\n            \"service-date\": \"http://hl7.org/fhir/us/carin-bb/SearchParameter/explanationofbenefit-service-date\"\n        }\n    },\n    \"Patient\": {\n        \"searchParameters\": {}\n    },\n    \"RelatedPerson\": {\n        \"searchParameters\": {}\n    },\n    \"Resource\": {\n        \"searchParameters\": {\n            \"_id\": \"http://hl7.org/fhir/SearchParameter/Resource-id\",\n            \"_lastUpdated\": \"http://hl7.org/fhir/SearchParameter/Resource-lastUpdated\"\n        }\n    }\n}\n`}</code></pre>\n    <p>{`For reference, the following is the list of codes in this category:`}</p>\n    <table>\n      <thead parentName=\"table\">\n        <tr parentName=\"thead\">\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`code`}</th>\n        </tr>\n      </thead>\n      <tbody parentName=\"table\">\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`_id`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`_lastUpdated`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`_profile`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`_security`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`_source`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`_tag`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`_content`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`_query`}</td>\n        </tr>\n      </tbody>\n    </table>\n    <p>{`Note: `}<inlineCode parentName=\"p\">{`_content`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`_query`}</inlineCode>{` are not yet supported by the LinuxForHealth FHIR Server.`}</p>\n    <p>{`The filter `}<inlineCode parentName=\"p\">{`\"*\": \"*\"`}</inlineCode>{` is not necessary to include these Resource-level parameters.`}</p>\n    <h4>{`1.2.1 Handling unexpected search parameters`}</h4>\n    <p>{`The LinuxForHealth FHIR Server supports configurable handling of unknown or unsupported search parameters as defined at `}<a parentName=\"p\" {...{\n        \"href\": \"https://linuxforhealth.github.io/FHIR/Conformance#http-headers\"\n      }}>{`https://linuxforhealth.github.io/FHIR/Conformance#http-headers`}</a>{`.\nFiltered search parameters are handled exactly the same as undefined search parameters, meaning that searches which include these parameters will fail in `}<inlineCode parentName=\"p\">{`strict`}</inlineCode>{` mode.`}</p>\n    <h4>{`1.2.2 Compartment search considerations with filtering`}</h4>\n    <p>{`For each compartment type, the rules for determining if a resource is a member of a compartment of that type, and thus if that resource should be returned on an associated compartment search, are based on inclusion criteria. Inclusion criteria is one or more search parameters whose value is a reference to the compartment resource type. These membership rules are defined by the FHIR specification for the following compartments:`}</p>\n    <ul>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://hl7.org/fhir/R4B/compartmentdefinition-device.html\"\n        }}>{`Device`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://hl7.org/fhir/R4B/compartmentdefinition-encounter.html\"\n        }}>{`Encounter`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://hl7.org/fhir/R4B/compartmentdefinition-patient.html\"\n        }}>{`Patient`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://hl7.org/fhir/R4B/compartmentdefinition-practitioner.html\"\n        }}>{`Practitioner`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://hl7.org/fhir/R4B/compartmentdefinition-relatedperson.html\"\n        }}>{`RelatedPerson`}</a></li>\n    </ul>\n    <p>{`For example, for the `}<inlineCode parentName=\"p\">{`Patient`}</inlineCode>{` compartment, to determine if an `}<inlineCode parentName=\"p\">{`Observation`}</inlineCode>{` is a member, the inclusion criteria search parameters are `}<inlineCode parentName=\"p\">{`subject`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`performer`}</inlineCode>{`. If the `}<inlineCode parentName=\"p\">{`Observation`}</inlineCode>{` resource fields associated with these search parameters reference a `}<inlineCode parentName=\"p\">{`Patient`}</inlineCode>{` resource, the `}<inlineCode parentName=\"p\">{`Observation`}</inlineCode>{` resource is a member of that `}<inlineCode parentName=\"p\">{`Patient`}</inlineCode>{` compartment.`}</p>\n    <p>{`As of IBM FHIR Server 4.11.0, compartment membership is always evaluated during ingestion, even if the search parameters that define compartment membership have been filtered out in fhir-server-config.json.\nHowever, in cases where the inclusion criteria parameters have been overridden, it is still possible for server config to affect compartment membership.`}</p>\n    <h2>{`2 Re-index`}</h2>\n    <p>{`Reindexing is implemented as a custom operation that tells the LinuxForHealth FHIR Server to read a set of resources and replace the existing search parameters with those newly extracted from the resource body.`}</p>\n    <p>{`The `}<inlineCode parentName=\"p\">{`$reindex`}</inlineCode>{` operation can be invoked via an HTTP(S) POST to `}<inlineCode parentName=\"p\">{`[base]/$reindex`}</inlineCode>{`, `}<inlineCode parentName=\"p\">{`[base]/[type]/$reindex`}</inlineCode>{`, or `}<inlineCode parentName=\"p\">{`[base]/[type]/[instance]/$reindex`}</inlineCode>{`. By default, the operation at the System-level or Type-level selects 10 resources and re-extracts their search parameters values based on the current configuration of the server.`}</p>\n    <p>{`Reindexing is resource-intensive and can take several hours or even days to complete depending on the approach used, the number of resources currently in the system, and the capability of the hosting platform.`}</p>\n    <h3>{`2.1 Server-side-driven approach`}</h3>\n    <p>{`By default, the operation will select 10 resources and re-extract their search parameters values based on the current configuration of the server. The operation supports the following parameters to control the behavior:`}</p>\n    <table>\n      <thead parentName=\"table\">\n        <tr parentName=\"thead\">\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`name`}</th>\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`type`}</th>\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`description`}</th>\n        </tr>\n      </thead>\n      <tbody parentName=\"table\">\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`tstamp`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`string`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Reindex only resources not previously reindexed since this timestamp. Format as a date YYYY-MM-DD or time YYYY-MM-DDTHH:MM:SSZ.`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`resourceCount`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`integer`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`The maximum number of resources to reindex in this call. If this number is too large, the processing time might exceed the transaction timeout and fail.`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`force`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`boolean`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Force the parameters to be replaced even if the parameter hash matches. This is only required following a schema migration which changes how the parameters are stored in the database.`}</td>\n        </tr>\n      </tbody>\n    </table>\n    <p>{`The LinuxForHealth FHIR Server tracks when a resource was last reindexed and only resources with a reindex_tstamp value less than the given tstamp parameter will be processed. When a resource is reindexed, its reindex_tstamp is set to the given tstamp value. In most cases, using the current date (for example “2020-10-27”) is the best option for this value.`}</p>\n    <h3>{`2.2 Client-side-driven approach`}</h3>\n    <p>{`Another option is to have the client utilize the `}<inlineCode parentName=\"p\">{`$retrieve-index`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`$reindex`}</inlineCode>{` in parallel to drive the processing.`}</p>\n    <p>{`The `}<inlineCode parentName=\"p\">{`$retrieve-index`}</inlineCode>{` operation is called to retrieve index IDs of resources available for reindexing. This can be done repeatedly by using the `}<inlineCode parentName=\"p\">{`_count`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`afterIndexId`}</inlineCode>{` parameters for pagination. The operation supports the following parameters to control the behavior:`}</p>\n    <table>\n      <thead parentName=\"table\">\n        <tr parentName=\"thead\">\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`name`}</th>\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`type`}</th>\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`description`}</th>\n        </tr>\n      </thead>\n      <tbody parentName=\"table\">\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`_count`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`string`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`The maximum number of index IDs to retrieve. This may not exceed 1000. If not specified, the maximum number retrieved is 1000.`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`notModifiedAfter`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`string`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Only retrieve index IDs for resources not last updated after this timestamp. Format as a date YYYY-MM-DD or time YYYY-MM-DDTHH:MM:SSZ.`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`afterIndexId`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`string`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Retrieve index IDs starting with the first index ID after this index ID. If this parameter is not specified, the retrieved index IDs start with the first index ID.`}</td>\n        </tr>\n      </tbody>\n    </table>\n    <p>{`The `}<inlineCode parentName=\"p\">{`$retrieve-index`}</inlineCode>{` operation can be invoked via an HTTP(s) POST to `}<inlineCode parentName=\"p\">{`[base]/$retrieve-index`}</inlineCode>{` or `}<inlineCode parentName=\"p\">{`[base]/[type]/$retrieve-index`}</inlineCode>{`. Invoking this operation at the type-level only retrieves indexIDs for resources of that type.`}</p>\n    <p>{`The `}<inlineCode parentName=\"p\">{`$reindex`}</inlineCode>{` operation is called to reindex the resources with index IDs in the specified list. The operation supports the following parameters to control the behavior:`}</p>\n    <table>\n      <thead parentName=\"table\">\n        <tr parentName=\"thead\">\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`name`}</th>\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`type`}</th>\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`description`}</th>\n        </tr>\n      </thead>\n      <tbody parentName=\"table\">\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`indexIds`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`string`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Reindex only resources with an index ID in the specified list, formatted as a comma-delimited list of strings. If number of index IDs in the list is too large, the processing time might exceed the transaction timeout and fail.`}</td>\n        </tr>\n      </tbody>\n    </table>\n    <p>{`By specifying the index IDs on the `}<inlineCode parentName=\"p\">{`$reindex`}</inlineCode>{` operation, the LinuxForHealth FHIR Server avoids the database overhead of choosing the next resource to reindex and updating the reindex_tstamp. Though it requires the client side to track the reindex progress, it should allow for an overall faster reindex.`}</p>\n    <h3>{`2.3 fhir-bucket`}</h3>\n    <p>{`To aid in the re-indexing process, the LinuxForHealth FHIR Server team has expanded the fhir-bucket resource-loading tool to support driving the reindex, with the option of using either the server-side-driven or client-side-driven approach. The fhir-bucket tool uses a thread-pool to make concurrent POST requests to the LinuxForHealth FHIR Server `}<inlineCode parentName=\"p\">{`$retrieve-index`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`$reindex`}</inlineCode>{` custom operations.`}</p>\n    <p>{`For more information on driving the reindex operation from fhir-bucket, see `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/LinuxForHealth/FHIR/tree/main/fhir-bucket#driving-the-reindex-custom-operation\"\n      }}>{`https://github.com/LinuxForHealth/FHIR/tree/main/fhir-bucket#driving-the-reindex-custom-operation`}</a>{`.`}</p>\n    <hr></hr>\n    <p>{`FHIR® is the registered trademark of HL7 and is used with the permission of HL7.`}</p>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}